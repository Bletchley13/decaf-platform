DroidScope (DS) is a dynamic analysis platform based off of the Android Emulator. 

Please see the original paper for more information on the concept.

https://www.usenix.org/conference/usenixsecurity12/droidscope-seamlessly-reconstructing-os-and-dalvik-semantic-views


== DECAF DroidScope ==

Since the original paper, we have been porting DS to run on top of the DECAF binary analysis platform the immediate advantages are:

# Seamless ARM and x86 Native API support
# Dynamic loading of plugins
# More refined NativeAPI - more callbacks, and some bug fixes
# Better Virtual Machine Introspection support

NOTE: DECAF is based off a newer version of QEMU, however the core changes to translate.c, monitor.c and etc. are the same. 

== DroidScope Getting Started ===

The current version of DS is built for Android Gingerbread. Since we mainly deal with the 32-bit ARM architecture and we include some files from the Android source code as part of DS we require that the host machine be a 32-bit machine. DECAF does not have this limitation.

Thus far, DroidScope has been tested on Linux Mint 14 Nadia, but it should also work for Ubuntu 12.10 since Nadia is based off of it. 

=== Compiling Android ===

One of the biggest difficulties in compiling Android in newer distributions is GCC 4.7. The following are some directions for building the Android source on Nadia

From a fresh install

First – Install the necessary packages:

sudo apt-get install git-core gnupg flex bison gperf dpkg-dev gcc-multilib build-essential   zip curl libc6-dev libncurses5-dev:i386 x11proto-core-dev   libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-glx:i386   libgl1-mesa-dev g++-multilib mingw32 openjdk-6-jdk tofrodos   python-markdown libxml2-utils xsltproc zlib1g-dev:i386 libgl-dev

Second – Grab the source (http://source.android.com/source/downloading.html)

Third – Download and apply the patch (https://haven.ecs.syr.edu/~lok/AndroidGingerbread_GCC47.diff)

Fourth – Either do an update on QEMU to get to version 12 (http://source.android.com/source/known-issues.html) or download and apply the patch (https://haven.ecs.syr.edu/~lok/AndroidGingerbread_QEMU_12.diff)

Fifth – Build the source according to the directions (http://source.android.com/source/building.html)

=== Compiling DroidScope ===

DroidScope is integrated DIRECTLY into the android emulator source in "external/qemu" and we build DroidScope in the qemu directory directly. In order to build qemu as a standalone we must first install some more packages. 

sudo apt-get install libglib2.0-dev libasound2-dev libpulse-dev

Once that is done, then download the patch from the downloads section and patch the source.

Once patched run the configuration script (e.g. ./android-configure) and then run make to build it.

=== Running DroidScope ===

To run DroidScope simply go into the "objs" directory and run the emulator. The command that I have used is:

./emulator -sysdir ~/scratch/android-gingerbread/out/target/product/generic/ -kernel ~/scratch/android-gingerbread/prebuilt/android-arm/kernel/kernel-qemu-armv7 -qemu -monitor stdio

Make sure you "touch ~/scratch/android-gingerbread/out/target/product/generic/userdata-qemu.img" to create that file, otherwise you will get an error.

Running the command will bring up the qemu command prompt. Typing "help" will reveal the commands with the DECAF commands on the bottom. The commands that you should see are "ps", "pt" and "pm".

"ps" will show the shadow process list. You should be able to run that directly.

There is an additional command called "get_symbol_address" which can be used to determine the guest virtual address of a particular symbol. 

For example, "get_symbol_address 62 "/lib/libc.so" "printf"" should return the address of printf. 

If you run the command you will likely receive 0xffffffff as the address. This is because the symbol database has not been populated yet.

To do this you need to run the "./setupdumps.sh" script. The script does a number of things

# Download the libraries from the device into the "dumps" directory
# Download the apps from the virtual device into the "dumps" directory
# disassemble all of those files
# parse them to obtain the symbols

Run the script and follow the messages to fix any errors.

Since the symbols are loaded when the libraries (within the shadow module list) are first discovered, you will need to kill the emulator and restart it in order to see "get_symbol_address" work.

=== Plugins ===

While plugins used to be 
